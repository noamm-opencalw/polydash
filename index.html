<!DOCTYPE html>
<html lang="he" dir="rtl">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover" />
  <title>PolyDash â€” ×©×•×§ ×”× ×™×‘×•×™×™×</title>
  <meta name="description" content="PolyDash â€” ×œ×•×— ××—×•×•× ×™× ×—×™ ×œ×©×•×§ ×”× ×™×‘×•×™×™× Polymarket" />
  <meta name="theme-color" content="#0d0818" />
  <link rel="preconnect" href="https://fonts.googleapis.com" />
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
  <link href="https://fonts.googleapis.com/css2?family=Assistant:wght@400;600;700;800&display=swap" rel="stylesheet" />
  <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.2/dist/chart.umd.min.js"></script>

  <style>
    /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
       DESIGN TOKENS â€” Single Source of Truth
    â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
    :root {
      /* Base */
      --bg-base:          #0d0818;
      --bg-elevated:      rgba(255,255,255,0.04);
      --bg-card:          rgba(255,255,255,0.05);
      --bg-card-hover:    rgba(255,255,255,0.09);

      /* Glass */
      --glass-border:     rgba(255,255,255,0.09);
      --glass-blur:       blur(16px);

      /* Accent */
      --accent:           #7C3AED;
      --accent-lt:        rgba(124,58,237,0.18);
      --accent-glow:      rgba(124,58,237,0.35);

      /* Signal â€” ONLY for data changes */
      --yes:              #10b981;
      --yes-bg:           rgba(16,185,129,0.14);
      --no:               #f43f5e;
      --no-bg:            rgba(244,63,94,0.14);
      --up:               #10b981;
      --down:             #f43f5e;

      /* Neutral text (WCAG AA âœ“) */
      --text-1:           #f1f5f9;   /* slate-100 â€” primary */
      --text-2:           #94a3b8;   /* slate-400 â€” secondary */
      --text-3:           #475569;   /* slate-600 â€” meta/dim */

      /* Spacing â€” Power User Mode (15-20% tighter) */
      --s-xs:             4px;
      --s-sm:             8px;
      --s-md:             14px;
      --s-lg:             20px;
      --s-xl:             28px;

      /* Typography */
      --fs-xs:            11px;
      --fs-sm:            13px;
      --fs-base:          15px;
      --fs-lg:            17px;
      --fs-xl:            22px;
      --fs-2xl:           30px;

      /* Radius */
      --r-sm:             8px;
      --r-md:             14px;
      --r-lg:             18px;
      --r-pill:           100px;

      /* Shadows */
      --shadow-card:      0 2px 8px rgba(0,0,0,0.45), 0 0 0 1px var(--glass-border);
      --shadow-hover:     0 8px 32px rgba(124,58,237,0.25), 0 0 0 1px rgba(124,58,237,0.35);

      /* Transitions */
      --t:                all 0.2s cubic-bezier(0.4,0,0.2,1);
      --t-slow:           all 0.35s cubic-bezier(0.4,0,0.2,1);
    }

    /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
       RESET & BASE
    â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
    *, *::before, *::after { box-sizing: border-box; margin: 0; padding: 0; }

    html { scroll-behavior: smooth; }

    body {
      font-family: 'Assistant', -apple-system, BlinkMacSystemFont, sans-serif;
      background: var(--bg-base);
      color: var(--text-1);
      min-height: 100vh;
      direction: rtl;
      -webkit-overflow-scrolling: touch;
      /* iPhone 17 Pro safe areas */
      padding-bottom: env(safe-area-inset-bottom);
    }

    /* Background gradient overlay */
    body::before {
      content: '';
      position: fixed; inset: 0;
      background:
        radial-gradient(ellipse 80% 50% at 20% 10%, rgba(124,58,237,0.12) 0%, transparent 60%),
        radial-gradient(ellipse 60% 40% at 80% 80%, rgba(59,130,246,0.06) 0%, transparent 60%);
      pointer-events: none; z-index: 0;
    }

    main { position: relative; z-index: 1; }

    /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
       HEADER
    â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
    header {
      position: sticky; top: 0; z-index: 100;
      background: rgba(13,8,24,0.88);
      backdrop-filter: blur(20px);
      -webkit-backdrop-filter: blur(20px);
      border-bottom: 1px solid var(--glass-border);
      /* iPhone 17 Pro safe area */
      padding-top: max(var(--s-md), env(safe-area-inset-top));
      padding-right: env(safe-area-inset-right);
      padding-left: env(safe-area-inset-left);
    }

    .header-inner {
      max-width: 520px;
      margin: 0 auto;
      padding: 0 var(--s-md);
    }

    .header-top {
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 0 0 var(--s-sm);
    }

    .logo {
      display: flex; align-items: center; gap: var(--s-sm);
    }

    .logo-icon {
      width: 34px; height: 34px;
      background: linear-gradient(135deg, var(--accent), #9f67ff);
      border-radius: var(--r-sm);
      display: flex; align-items: center; justify-content: center;
      font-size: 17px;
      box-shadow: 0 0 14px var(--accent-glow);
    }

    .logo-info { display: flex; flex-direction: column; }
    .logo-name { font-size: 19px; font-weight: 800; color: var(--text-1); letter-spacing: -0.5px; line-height: 1.1; }
    .logo-sub  { font-size: var(--fs-xs); color: var(--text-3); font-weight: 400; }

    /* Live indicator */
    .live-badge {
      display: flex; align-items: center; gap: 5px;
      background: var(--yes-bg);
      border: 1px solid rgba(16,185,129,0.25);
      border-radius: var(--r-pill);
      padding: 4px 10px;
      font-size: var(--fs-xs); font-weight: 700;
      color: var(--yes);
      cursor: pointer; transition: var(--t);
      min-height: 44px;
    }
    .live-badge:hover { background: rgba(16,185,129,0.2); }
    .live-badge:active { transform: scale(0.95); }

    .live-dot {
      width: 7px; height: 7px;
      background: var(--yes);
      border-radius: 50%;
      animation: pulse-live 2s ease-in-out infinite;
    }
    @keyframes pulse-live {
      0%,100% { opacity: 1; transform: scale(1); }
      50%      { opacity: 0.5; transform: scale(1.4); }
    }

    /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
       CATEGORY TABS
    â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
    .tabs-wrap {
      overflow-x: auto; overflow-y: hidden;
      -webkit-overflow-scrolling: touch;
      scrollbar-width: none;
      padding-bottom: var(--s-sm);
    }
    .tabs-wrap::-webkit-scrollbar { display: none; }

    .tabs {
      display: flex; gap: var(--s-xs);
      width: max-content;
    }

    .tab {
      background: transparent;
      border: 1px solid var(--glass-border);
      border-radius: var(--r-pill);
      padding: 5px 13px;
      font-size: var(--fs-sm); font-weight: 600;
      color: var(--text-2);
      cursor: pointer; transition: var(--t);
      white-space: nowrap;
      min-height: 44px; display: flex; align-items: center;
      font-family: 'Assistant', sans-serif;
    }
    .tab:hover { border-color: var(--accent); color: var(--text-1); }
    .tab.active {
      background: var(--accent-lt);
      border-color: var(--accent);
      color: var(--text-1);
    }
    .tab .badge {
      margin-right: 4px;
      background: var(--accent);
      color: white;
      border-radius: var(--r-pill);
      padding: 1px 6px;
      font-size: 10px; font-weight: 800;
    }

    /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
       HERO STATS BAR
    â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
    .stats-bar-wrap {
      overflow-x: auto;
      -webkit-overflow-scrolling: touch;
      scrollbar-width: none;
    }
    .stats-bar-wrap::-webkit-scrollbar { display: none; }

    .stats-bar {
      max-width: 520px;
      margin: 0 auto;
      display: flex; gap: var(--s-sm);
      padding: var(--s-md) var(--s-md) var(--s-sm);
      width: max-content;
    }

    .stat-pill {
      background: var(--bg-card);
      backdrop-filter: var(--glass-blur);
      border: 1px solid var(--glass-border);
      border-radius: var(--r-pill);
      padding: 6px 13px;
      display: flex; align-items: center; gap: 5px;
      white-space: nowrap;
    }
    .stat-pill .stat-icon { font-size: 14px; }
    .stat-pill .stat-val { font-size: var(--fs-sm); font-weight: 700; color: var(--text-1); }
    .stat-pill .stat-lbl { font-size: var(--fs-xs); color: var(--text-3); }

    /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
       SECTIONS
    â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
    .content {
      max-width: 520px;
      margin: 0 auto;
      padding: 0 var(--s-md) calc(var(--s-xl) + env(safe-area-inset-bottom));
    }

    .section { margin-bottom: var(--s-xl); }

    .section-header {
      display: flex; align-items: center; justify-content: space-between;
      margin-bottom: var(--s-md);
    }

    .section-title {
      font-size: var(--fs-lg); font-weight: 800;
      color: var(--text-1);
      display: flex; align-items: center; gap: 6px;
    }

    .section-count {
      font-size: var(--fs-xs); color: var(--text-3);
      background: var(--bg-card);
      border: 1px solid var(--glass-border);
      border-radius: var(--r-pill);
      padding: 2px 8px;
    }

    /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
       MARKET CARD
    â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
    .card {
      display: block;
      background: var(--bg-card);
      backdrop-filter: var(--glass-blur);
      -webkit-backdrop-filter: var(--glass-blur);
      border: 1px solid var(--glass-border);
      border-radius: var(--r-lg);
      padding: var(--s-md);
      margin-bottom: var(--s-sm);
      cursor: pointer; text-decoration: none; color: inherit;
      transition: var(--t);
      position: relative;
      box-shadow: var(--shadow-card);
      /* WCAG: min 44px touch target via min-height logic */
    }
    .card:hover, .card:focus-visible {
      background: var(--bg-card-hover);
      box-shadow: var(--shadow-hover);
      transform: translateY(-1px);
      border-color: rgba(124,58,237,0.35);
    }
    .card:active { transform: translateY(0) scale(0.99); }
    .card:focus-visible { outline: 2px solid var(--accent); outline-offset: 2px; }

    /* Card top row */
    .card-top {
      display: flex; align-items: flex-start; gap: var(--s-sm);
      margin-bottom: var(--s-sm);
    }

    .card-img {
      width: 38px; height: 38px; flex-shrink: 0;
      border-radius: var(--r-sm);
      object-fit: cover;
      background: var(--bg-elevated);
    }
    .card-img-placeholder {
      width: 38px; height: 38px; flex-shrink: 0;
      border-radius: var(--r-sm);
      background: var(--accent-lt);
      display: flex; align-items: center; justify-content: center;
      font-size: 18px;
    }

    .card-info { flex: 1; min-width: 0; }

    .card-title {
      font-size: var(--fs-base); font-weight: 700;
      color: var(--text-1); line-height: 1.35;
      display: -webkit-box;
      -webkit-line-clamp: 2; -webkit-box-orient: vertical;
      overflow: hidden;
      margin-bottom: 3px;
    }

    .card-meta {
      display: flex; flex-wrap: wrap; align-items: center; gap: 5px;
    }
    .card-cat {
      font-size: var(--fs-xs); font-weight: 600;
      color: var(--accent);
      background: var(--accent-lt);
      border-radius: var(--r-pill);
      padding: 2px 7px;
    }
    .card-date {
      font-size: var(--fs-xs); color: var(--text-3);
    }

    /* Action buttons â€” visible on hover */
    .card-actions {
      display: flex; gap: var(--s-xs);
      opacity: 0; transition: var(--t);
      align-items: center;
    }
    .card:hover .card-actions,
    .card:focus-within .card-actions { opacity: 1; }

    .action-btn {
      width: 32px; height: 32px;
      background: var(--bg-elevated);
      border: 1px solid var(--glass-border);
      border-radius: var(--r-sm);
      display: flex; align-items: center; justify-content: center;
      font-size: 14px;
      cursor: pointer; transition: var(--t);
      color: var(--text-2);
      flex-shrink: 0;
    }
    .action-btn:hover { background: var(--accent-lt); border-color: var(--accent); color: var(--accent); }
    .action-btn.starred { color: #fbbf24; border-color: rgba(251,191,36,0.3); background: rgba(251,191,36,0.1); }

    /* Probability bars */
    .prob-bars {
      margin-bottom: var(--s-sm);
    }

    .prob-row {
      display: flex; align-items: center; gap: var(--s-sm);
      margin-bottom: 5px;
    }
    .prob-row:last-child { margin-bottom: 0; }

    .prob-label {
      font-size: var(--fs-xs); font-weight: 700;
      width: 24px; flex-shrink: 0;
    }
    .prob-label.yes { color: var(--yes); }
    .prob-label.no  { color: var(--no); }

    .prob-bar-bg {
      flex: 1; height: 6px;
      background: rgba(255,255,255,0.07);
      border-radius: 3px; overflow: hidden;
    }
    .prob-bar-fill {
      height: 100%; border-radius: 3px;
      transition: width 0.6s cubic-bezier(0.4,0,0.2,1);
    }
    .prob-bar-fill.yes { background: linear-gradient(90deg, var(--yes), #34d399); }
    .prob-bar-fill.no  { background: linear-gradient(90deg, var(--no), #fb7185); }

    .prob-pct {
      font-size: var(--fs-sm); font-weight: 800;
      width: 34px; text-align: left; flex-shrink: 0;
      transition: var(--t);
    }
    .prob-pct.yes { color: var(--yes); }
    .prob-pct.no  { color: var(--no); }

    /* Price flash animation */
    @keyframes price-flash-up {
      0%   { background: transparent; }
      20%  { background: rgba(16,185,129,0.22); border-radius: 4px; }
      100% { background: transparent; }
    }
    @keyframes price-flash-down {
      0%   { background: transparent; }
      20%  { background: rgba(244,63,94,0.22); border-radius: 4px; }
      100% { background: transparent; }
    }
    .flash-up   { animation: price-flash-up   1.4s ease; }
    .flash-down { animation: price-flash-down 1.4s ease; }

    /* Card footer */
    .card-footer {
      display: flex; align-items: center; justify-content: space-between;
      border-top: 1px solid var(--glass-border);
      padding-top: var(--s-sm);
      gap: var(--s-sm);
    }

    /* Net return (financial truth) */
    .net-return {
      display: flex; align-items: baseline; gap: 4px;
    }
    .net-val {
      font-size: var(--fs-sm); font-weight: 800;
      color: var(--yes);
    }
    .gross-val {
      font-size: var(--fs-xs); color: var(--text-3);
      font-style: italic;
    }
    .net-label {
      font-size: var(--fs-xs); color: var(--text-3);
    }

    /* Volume + change badge */
    .card-stats {
      display: flex; align-items: center; gap: var(--s-sm);
    }
    .vol-txt {
      font-size: var(--fs-xs); color: var(--text-3);
    }
    .change-badge {
      font-size: var(--fs-xs); font-weight: 700;
      border-radius: var(--r-pill);
      padding: 2px 7px;
    }
    .change-badge.up   { color: var(--up);   background: var(--yes-bg); }
    .change-badge.down { color: var(--down); background: var(--no-bg); }

    /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
       WATCHLIST EMPTY STATE
    â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
    .empty-watch {
      text-align: center;
      padding: var(--s-xl) var(--s-lg);
      color: var(--text-3);
    }
    .empty-watch .empty-icon { font-size: 36px; margin-bottom: var(--s-sm); display: block; }
    .empty-watch p { font-size: var(--fs-sm); line-height: 1.5; }

    /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
       QUICK VIEW MODAL
    â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
    .modal-overlay {
      position: fixed; inset: 0; z-index: 200;
      background: rgba(13,8,24,0.72);
      backdrop-filter: blur(8px);
      -webkit-backdrop-filter: blur(8px);
      display: flex; align-items: flex-end; justify-content: center;
      opacity: 0; pointer-events: none;
      transition: opacity 0.25s ease;
    }
    .modal-overlay.open { opacity: 1; pointer-events: all; }

    .modal-sheet {
      background: #170e2a;
      border: 1px solid var(--glass-border);
      border-radius: var(--r-lg) var(--r-lg) 0 0;
      width: 100%; max-width: 520px;
      padding: var(--s-lg);
      padding-bottom: calc(var(--s-lg) + env(safe-area-inset-bottom));
      transform: translateY(100%);
      transition: transform 0.3s cubic-bezier(0.4,0,0.2,1);
      max-height: 85vh;
      overflow-y: auto;
    }
    .modal-overlay.open .modal-sheet { transform: translateY(0); }

    .modal-handle {
      width: 40px; height: 4px;
      background: var(--text-3);
      border-radius: 2px;
      margin: 0 auto var(--s-md);
    }

    .modal-header { display: flex; align-items: flex-start; justify-content: space-between; gap: var(--s-sm); margin-bottom: var(--s-md); }
    .modal-title  { font-size: var(--fs-lg); font-weight: 800; color: var(--text-1); line-height: 1.3; flex: 1; }
    .modal-close  {
      width: 32px; height: 32px; flex-shrink: 0;
      background: var(--bg-elevated); border: 1px solid var(--glass-border);
      border-radius: var(--r-sm); cursor: pointer;
      display: flex; align-items: center; justify-content: center;
      font-size: 16px; color: var(--text-2); transition: var(--t);
    }
    .modal-close:hover { background: var(--no-bg); color: var(--no); }

    .modal-img {
      width: 100%; height: 130px;
      object-fit: cover; border-radius: var(--r-md);
      margin-bottom: var(--s-md);
      background: var(--bg-elevated);
    }

    .modal-prob-section { margin-bottom: var(--s-md); }
    .modal-prob-title { font-size: var(--fs-sm); color: var(--text-3); margin-bottom: var(--s-sm); font-weight: 600; }

    .modal-big-prob {
      display: flex; gap: var(--s-md);
      margin-bottom: var(--s-md);
    }
    .big-prob-item {
      flex: 1;
      background: var(--bg-card);
      border: 1px solid var(--glass-border);
      border-radius: var(--r-md);
      padding: var(--s-md);
      text-align: center;
    }
    .big-prob-item.yes-item { border-color: rgba(16,185,129,0.25); background: var(--yes-bg); }
    .big-prob-item.no-item  { border-color: rgba(244,63,94,0.2);  background: var(--no-bg); }
    .big-prob-lbl { font-size: var(--fs-xs); font-weight: 600; margin-bottom: 2px; }
    .big-prob-lbl.yes { color: var(--yes); }
    .big-prob-lbl.no  { color: var(--no); }
    .big-prob-val { font-size: var(--fs-2xl); font-weight: 800; }
    .big-prob-val.yes { color: var(--yes); }
    .big-prob-val.no  { color: var(--no); }

    .modal-desc {
      font-size: var(--fs-sm); color: var(--text-2); line-height: 1.6;
      margin-bottom: var(--s-md);
    }

    .modal-meta-grid {
      display: grid; grid-template-columns: 1fr 1fr;
      gap: var(--s-sm); margin-bottom: var(--s-lg);
    }
    .meta-item { }
    .meta-lbl  { font-size: var(--fs-xs); color: var(--text-3); margin-bottom: 2px; }
    .meta-val  { font-size: var(--fs-sm); font-weight: 700; color: var(--text-1); }

    .modal-net-box {
      background: var(--yes-bg);
      border: 1px solid rgba(16,185,129,0.25);
      border-radius: var(--r-md);
      padding: var(--s-md);
      margin-bottom: var(--s-md);
    }
    .modal-net-title { font-size: var(--fs-xs); color: var(--yes); font-weight: 600; margin-bottom: 4px; }
    .modal-net-val   { font-size: var(--fs-xl); font-weight: 800; color: var(--yes); }
    .modal-net-sub   { font-size: var(--fs-xs); color: var(--text-3); margin-top: 2px; }

    .modal-cta {
      display: block; width: 100%;
      background: var(--accent);
      color: white; font-weight: 800; font-size: var(--fs-base);
      border: none; border-radius: var(--r-md);
      padding: 14px;
      text-align: center; text-decoration: none;
      transition: var(--t); cursor: pointer;
      font-family: 'Assistant', sans-serif;
      min-height: 44px;
    }
    .modal-cta:hover { background: #6d28d9; transform: translateY(-1px); }
    .modal-cta:active { transform: scale(0.98); }

    /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
       LOADER / SKELETON
    â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
    .skeleton {
      background: linear-gradient(90deg, var(--bg-card) 25%, rgba(255,255,255,0.08) 50%, var(--bg-card) 75%);
      background-size: 200% 100%;
      animation: shimmer 1.5s infinite;
      border-radius: var(--r-md);
    }
    @keyframes shimmer {
      0%   { background-position: 200% 0; }
      100% { background-position: -200% 0; }
    }
    .skel-card { height: 120px; margin-bottom: var(--s-sm); }

    /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
       RECOMMENDATION CARD
    â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
    .rec-card {
      background: linear-gradient(135deg, rgba(124,58,237,0.18) 0%, rgba(59,130,246,0.12) 100%);
      border: 1px solid rgba(124,58,237,0.4);
      border-radius: var(--r-lg);
      padding: var(--s-md);
      margin-bottom: var(--s-lg);
      position: relative;
      overflow: hidden;
    }
    .rec-card::before {
      content: '';
      position: absolute; top: 0; right: 0;
      width: 120px; height: 120px;
      background: radial-gradient(circle, rgba(124,58,237,0.2) 0%, transparent 70%);
      pointer-events: none;
    }
    .rec-label {
      font-size: var(--fs-xs); font-weight: 800;
      color: var(--accent);
      text-transform: uppercase;
      letter-spacing: 0.5px;
      margin-bottom: var(--s-xs);
      display: flex; align-items: center; gap: 5px;
    }
    .rec-title {
      font-size: var(--fs-base); font-weight: 700;
      color: var(--text-1); line-height: 1.4;
      margin-bottom: var(--s-sm);
      display: -webkit-box;
      -webkit-line-clamp: 2; -webkit-box-orient: vertical;
      overflow: hidden;
    }
    .rec-reasoning {
      list-style: none;
      margin-bottom: var(--s-sm);
    }
    .rec-reasoning li {
      font-size: var(--fs-xs); color: var(--text-2);
      padding: 2px 0;
      display: flex; align-items: flex-start; gap: 5px;
    }
    .rec-reasoning li::before { content: 'â†’'; color: var(--accent); flex-shrink: 0; }
    .rec-footer {
      display: flex; align-items: center; justify-content: space-between;
      flex-wrap: wrap; gap: var(--s-xs);
    }
    .rec-side {
      font-size: var(--fs-sm); font-weight: 800;
      padding: 4px 10px; border-radius: var(--r-pill);
    }
    .rec-side.yes { background: var(--yes-bg); color: var(--yes); }
    .rec-side.no  { background: var(--no-bg);  color: var(--no); }
    .rec-prob {
      font-size: var(--fs-sm); color: var(--text-2);
    }
    .rec-cta {
      font-size: var(--fs-xs); font-weight: 700;
      color: white; background: var(--accent);
      border-radius: var(--r-pill);
      padding: 5px 12px; text-decoration: none;
      transition: var(--t);
    }
    .rec-cta:hover { background: #6d28d9; }

    /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
       CHART SECTIONS
    â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
    .chart-wrap {
      background: var(--bg-card);
      border: 1px solid var(--glass-border);
      border-radius: var(--r-lg);
      padding: var(--s-md);
      margin-bottom: var(--s-lg);
    }
    .chart-title {
      font-size: var(--fs-base); font-weight: 800;
      color: var(--text-1); margin-bottom: 4px;
      display: flex; align-items: center; gap: 6px;
    }
    .chart-subtitle {
      font-size: var(--fs-xs); color: var(--text-3); margin-bottom: var(--s-md);
    }
    .chart-canvas-wrap {
      position: relative;
      height: 220px;
    }

    /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
       RESPONSIVE / ACCESSIBILITY
    â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
    @media (prefers-reduced-motion: reduce) {
      *, *::before, *::after { animation-duration: 0.01ms !important; transition-duration: 0.01ms !important; }
    }
    @media (hover: none) {
      .card-actions { opacity: 1; }
    }
  </style>
</head>
<body>

<!-- â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ HEADER â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ -->
<header>
  <div class="header-inner">
    <div class="header-top">
      <div class="logo">
        <div class="logo-icon">ğŸ”®</div>
        <div class="logo-info">
          <span class="logo-name">PolyDash</span>
          <span class="logo-sub">×©×•×§ ×”× ×™×‘×•×™×™× ×”×—×™</span>
        </div>
      </div>
      <button class="live-badge" id="refreshBtn" aria-label="×¨×¢× ×Ÿ × ×ª×•× ×™×" title="×œ×—×¥ ×œ×¨×¢× ×•×Ÿ">
        <span class="live-dot"></span>
        <span id="liveLabel">LIVE</span>
      </button>
    </div>

    <div class="tabs-wrap" role="tablist" aria-label="×¡×™× ×•×Ÿ ×œ×¤×™ ×§×˜×’×•×¨×™×”">
      <div class="tabs" id="tabs">
        <button class="tab active" data-cat="all"      role="tab" aria-selected="true">×”×›×œ</button>
        <button class="tab"        data-cat="politics" role="tab">ğŸ—³ï¸ ×¤×•×œ×™×˜×™×§×”</button>
        <button class="tab"        data-cat="economy"  role="tab">ğŸ’° ×›×œ×›×œ×”</button>
        <button class="tab"        data-cat="geo"      role="tab">ğŸŒ ×’××•×¤×•×œ×™×˜×™×§×”</button>
        <button class="tab"        data-cat="sports"   role="tab">ğŸ† ×¡×¤×•×¨×˜</button>
        <button class="tab"        data-cat="crypto"   role="tab">â‚¿ ×§×¨×™×¤×˜×•</button>
        <button class="tab"        data-cat="tech"     role="tab">ğŸ”¬ ×˜×›× ×•×œ×•×’×™×”</button>
        <button class="tab"        data-cat="watch"    role="tab" id="watchTab">â­ ××¢×§×‘ <span class="badge" id="watchBadge" style="display:none">0</span></button>
        <button class="tab"        data-cat="signals"  role="tab" id="signalsTab">ğŸ“¡ Signals <span class="badge" id="signalsBadge" style="display:none">0</span></button>
        <button class="tab"        data-cat="analysis" role="tab" id="analysisTab">ğŸ“Š × ×™×ª×•×—</button>
      </div>
    </div>
  </div>
</header>

<!-- â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ STATS BAR â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ -->
<div class="stats-bar-wrap" role="region" aria-label="×¡×˜×˜×™×¡×˜×™×§×•×ª">
  <div class="stats-bar" id="statsBar">
    <div class="stat-pill skeleton" style="width:110px;height:34px;border-radius:100px"></div>
    <div class="stat-pill skeleton" style="width:130px;height:34px;border-radius:100px"></div>
    <div class="stat-pill skeleton" style="width:100px;height:34px;border-radius:100px"></div>
    <div class="stat-pill skeleton" style="width:110px;height:34px;border-radius:100px"></div>
  </div>
</div>

<!-- â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ MAIN CONTENT â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ -->
<main>
  <div class="content" id="mainContent">
    <!-- Skeleton loading state -->
    <div id="skeleton-view">
      <div class="section-title" style="margin-bottom:12px;opacity:0.4">ğŸ”¥ ×—× ×¢×›×©×™×•</div>
      <div class="skel-card skeleton"></div>
      <div class="skel-card skeleton"></div>
      <div class="skel-card skeleton"></div>
    </div>

    <!-- Real content injected by JS -->
    <div id="real-content" style="display:none"></div>
  </div>
</main>

<!-- â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ QUICK VIEW MODAL â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ -->
<div class="modal-overlay" id="modalOverlay" role="dialog" aria-modal="true" aria-labelledby="modalTitle">
  <div class="modal-sheet" id="modalSheet">
    <div class="modal-handle"></div>
    <div class="modal-header">
      <h2 class="modal-title" id="modalTitle">â€”</h2>
      <button class="modal-close" id="modalClose" aria-label="×¡×’×•×¨">âœ•</button>
    </div>
    <div id="modalBody"></div>
  </div>
</div>

<!-- â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ JAVASCRIPT â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ -->
<script>
'use strict';

/* â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
   CONSTANTS & STATE
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
const DATA_URL     = './data.json';
const REFRESH_MS   = 5 * 60 * 1000;  // 5 min
const WATCH_KEY    = 'polydash_watchlist';
const CAT_LABELS   = { all:'×”×›×œ', politics:'ğŸ—³ï¸ ×¤×•×œ×™×˜×™×§×”', economy:'ğŸ’° ×›×œ×›×œ×”', geo:'ğŸŒ ×’××•×¤×•×œ×™×˜×™×§×”', sports:'ğŸ† ×¡×¤×•×¨×˜', crypto:'â‚¿ ×§×¨×™×¤×˜×•', tech:'ğŸ”¬ ×˜×›× ×•×œ×•×’×™×”', other:'×¢×•×“' };

let appData     = null;
let prevData    = null;
let activeTab   = 'all';
let modalMarket = null;

/* â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
   FINANCIAL TRUTH â€” NET RETURNS
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
function calcNet(yesPct, bet = 100) {
  const p = yesPct / 100;
  if (p <= 0.01 || p >= 0.99) return null;
  const shares    = bet / p;
  const gross     = shares * (1 - p);
  const afterFees = gross - (bet * 0.001);
  const net       = afterFees * 0.75;          // 25% tax
  const roi       = ((net / bet) * 100).toFixed(0);
  return { net: net.toFixed(1), gross: gross.toFixed(1), roi };
}

/* â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
   WATCHLIST (localStorage)
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
function getWatchlist() {
  try { return JSON.parse(localStorage.getItem(WATCH_KEY) || '[]'); } catch { return []; }
}
function saveWatchlist(ids) {
  localStorage.setItem(WATCH_KEY, JSON.stringify(ids));
  updateWatchBadge();
}
function isWatched(id) { return getWatchlist().includes(String(id)); }
function toggleWatch(id, el) {
  const ids = getWatchlist();
  const sid = String(id);
  const idx = ids.indexOf(sid);
  if (idx === -1) { ids.push(sid); el.classList.add('starred'); el.title = '×”×¡×¨ ×××¢×§×‘'; }
  else            { ids.splice(idx, 1); el.classList.remove('starred'); el.title = '×”×•×¡×£ ×œ××¢×§×‘'; }
  saveWatchlist(ids);
  if (activeTab === 'watch') renderView();
}
function updateWatchBadge() {
  const n = getWatchlist().length;
  const badge = document.getElementById('watchBadge');
  if (badge) { badge.textContent = n; badge.style.display = n > 0 ? 'inline' : 'none'; }
}

/* â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
   HELPERS
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
function fmt$( n ) { if (!n) return '$0'; const v = parseFloat(n); if (v >= 1e9) return '$'+(v/1e9).toFixed(1)+'B'; if (v >= 1e6) return '$'+(v/1e6).toFixed(1)+'M'; if (v >= 1e3) return '$'+(v/1e3).toFixed(0)+'K'; return '$'+v.toFixed(0); }
function fmtDate(s) { if (!s) return 'â€”'; const d = new Date(s); const now = new Date(); const diff = Math.round((d-now)/(1000*60*60*24)); if (diff < 0) return '×”×¡×ª×™×™×'; if (diff === 0) return '×”×™×•×'; if (diff === 1) return '××—×¨'; if (diff < 7) return `${diff} ×™××™×`; if (diff < 30) return `${Math.round(diff/7)} ×©×‘×•×¢×•×ª`; if (diff < 365) return `${Math.round(diff/30)} ×—×•×“×©×™×`; return `${Math.round(diff/365)} ×©× ×™×`; }
function fmtAgo(s) { if (!s) return ''; const d = new Date(s); const diff = Math.round((Date.now()-d)/60000); if (diff < 1) return '×¢×›×©×™×•'; if (diff < 60) return `×œ×¤× ×™ ${diff} ×“×§×³`; return `×œ×¤× ×™ ${Math.round(diff/60)} ×©×¢×³`; }
function catEmoji(c) { const m = {politics:'ğŸ—³ï¸',economy:'ğŸ’°',geo:'ğŸŒ',sports:'ğŸ†',crypto:'â‚¿',tech:'ğŸ”¬',other:'ğŸ’¡'}; return (m[c]||'ğŸ’¡')+' '+(CAT_LABELS[c]||c); }
function imgOrPlaceholder(m) {
  const emoji = {politics:'ğŸ—³ï¸',economy:'ğŸ’°',geo:'ğŸŒ',sports:'ğŸ†',crypto:'â‚¿',tech:'ğŸ”¬',other:'ğŸ’¡'};
  if (m.image) return `<img class="card-img" src="${esc(m.image)}" alt="" loading="lazy" onerror="this.style.display='none'" />`;
  return `<div class="card-img-placeholder">${emoji[m.category]||'ğŸ”®'}</div>`;
}
function esc(s) { return String(s||'').replace(/&/g,'&amp;').replace(/</g,'&lt;').replace(/>/g,'&gt;').replace(/"/g,'&quot;'); }

/* â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
   RENDER CARD
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
function buildCard(m, showChange) {
  const watched   = isWatched(m.id);
  const nr        = calcNet(m.yes_pct);
  const netHtml   = nr ? `<div class="net-return"><span class="net-label">× ×˜×•:</span><span class="net-val">+$${nr.net}</span><span class="gross-val">(×‘×¨×•×˜×• +$${nr.gross})</span></div>` : '';
  const volHtml   = `<span class="vol-txt">ğŸ“Š ${fmt$(m.volume24hr)}/24h</span>`;
  let changeBadge = '';
  if (showChange && m.oneWeekPriceChange !== undefined && m.oneWeekPriceChange !== 0) {
    const pct = (m.oneWeekPriceChange * 100).toFixed(1);
    const cls = pct > 0 ? 'up' : 'down';
    const arrow = pct > 0 ? 'â–²' : 'â–¼';
    changeBadge = `<span class="change-badge ${cls}">${arrow} ${Math.abs(pct)}%</span>`;
  }

  return `
  <div class="card" data-id="${esc(m.id)}" data-cat="${esc(m.category)}"
       role="article" tabindex="0" aria-label="${esc(m.question)}">
    <div class="card-top">
      ${imgOrPlaceholder(m)}
      <div class="card-info">
        <div class="card-title">${esc(m.question)}</div>
        <div class="card-meta">
          <span class="card-cat">${catEmoji(m.category)}</span>
          <span class="card-date">â³ ${fmtDate(m.end_date)}</span>
        </div>
      </div>
      <div class="card-actions">
        <button class="action-btn ${watched?'starred':''}" data-star="${esc(m.id)}"
                title="${watched?'×”×¡×¨ ×××¢×§×‘':'×”×•×¡×£ ×œ××¢×§×‘'}" aria-label="×©××•×¨ ×œ××¢×§×‘">â­</button>
        <button class="action-btn" data-view="${esc(m.id)}"
                title="×ª×¦×•×’×” ××”×™×¨×”" aria-label="×¤×ª×— ×ª×¦×•×’×” ××”×™×¨×”">ğŸ‘</button>
      </div>
    </div>

    <div class="prob-bars" id="probs-${esc(m.id)}">
      <div class="prob-row">
        <span class="prob-label yes">YES</span>
        <div class="prob-bar-bg"><div class="prob-bar-fill yes" style="width:${m.yes_pct||0}%"></div></div>
        <span class="prob-pct yes" id="yes-${esc(m.id)}">${m.yes_pct||0}%</span>
      </div>
      <div class="prob-row">
        <span class="prob-label no">NO</span>
        <div class="prob-bar-bg"><div class="prob-bar-fill no" style="width:${m.no_pct||0}%"></div></div>
        <span class="prob-pct no">${m.no_pct||0}%</span>
      </div>
    </div>

    <div class="card-footer">
      ${netHtml}
      <div class="card-stats">${volHtml}${changeBadge}</div>
    </div>
  </div>`;
}

/* â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
   RENDER SECTIONS
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
function renderSection(title, markets, showChange = false) {
  if (!markets || !markets.length) return '';
  const filtered = activeTab === 'all' || activeTab === 'watch' ? markets
    : markets.filter(m => m.category === activeTab);
  if (!filtered.length) return '';
  return `
  <div class="section">
    <div class="section-header">
      <h2 class="section-title">${title}</h2>
      <span class="section-count">${filtered.length}</span>
    </div>
    ${filtered.map(m => buildCard(m, showChange)).join('')}
  </div>`;
}

/* â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
   CHARTS â€” instances stored to destroy on re-render
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
let chartInstances = {};

function destroyChart(id) {
  if (chartInstances[id]) {
    chartInstances[id].destroy();
    delete chartInstances[id];
  }
}

function buildHorizontalBar(canvasId, labels, values, colors, unit = '%') {
  destroyChart(canvasId);
  const ctx = document.getElementById(canvasId);
  if (!ctx) return;
  chartInstances[canvasId] = new Chart(ctx, {
    type: 'bar',
    data: {
      labels,
      datasets: [{
        data: values,
        backgroundColor: colors,
        borderRadius: 6,
        borderSkipped: false,
      }]
    },
    options: {
      indexAxis: 'y',
      responsive: true,
      maintainAspectRatio: false,
      plugins: {
        legend: { display: false },
        tooltip: {
          rtl: true,
          callbacks: {
            label: ctx => ` ${ctx.parsed.x}${unit}`,
          }
        }
      },
      scales: {
        x: {
          ticks: {
            color: '#94a3b8',
            font: { size: 11, family: "'Assistant', sans-serif" },
            callback: v => `${v}${unit}`,
          },
          grid: { color: 'rgba(255,255,255,0.06)' },
        },
        y: {
          ticks: {
            color: '#f1f5f9',
            font: { size: 11, family: "'Assistant', sans-serif" },
            callback: (_, i) => {
              const l = labels[i] || '';
              return l.length > 22 ? l.slice(0, 22) + 'â€¦' : l;
            }
          },
          grid: { display: false },
        }
      }
    }
  });
}

/* â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
   RECOMMENDATION CARD
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
function renderRecommendation(rec) {
  if (!rec) return '';
  const sideClass = (rec.bet_side || 'Yes').toLowerCase() === 'yes' ? 'yes' : 'no';
  const sideLabel = rec.bet_side || 'Yes';
  const scoreHtml = rec.score ? `<span style="font-size:12px;color:var(--text-3);margin-right:auto">×¦×™×•×Ÿ: ${rec.score}</span>` : '';
  const probHtml  = rec.yes_pct ? `<span class="rec-prob">YES ${rec.yes_pct}%</span>` : '';
  const ctaHtml   = rec.link ? `<a class="rec-cta" href="${esc(rec.link)}" target="_blank" rel="noopener">×¤×ª×— â†—</a>` : '';
  const reasonHtml = (rec.reasoning || []).filter(Boolean).map(r =>
    `<li>${esc(r)}</li>`
  ).join('');
  const actionBadge = rec.action === 'EXECUTE'
    ? `<span style="background:rgba(16,185,129,0.15);color:var(--yes);border:1px solid rgba(16,185,129,0.3);border-radius:4px;padding:2px 7px;font-size:11px;font-weight:700">ğŸŸ¢ EXECUTE</span>`
    : `<span style="background:rgba(255,255,255,0.07);color:var(--text-2);border:1px solid var(--glass-border);border-radius:4px;padding:2px 7px;font-size:11px">âšª DRY_RUN</span>`;

  return `
  <div class="rec-card">
    <div class="rec-label">ğŸ¯ ×”××œ×¦×ª ×”×™×•× ${actionBadge}</div>
    <div class="rec-title">${esc(rec.title)}</div>
    <ul class="rec-reasoning">${reasonHtml}</ul>
    <div class="rec-footer">
      <span class="rec-side ${sideClass}">×”×™××•×¨: ${sideLabel}</span>
      ${probHtml}
      ${scoreHtml}
      ${ctaHtml}
    </div>
  </div>`;
}

/* â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
   ANALYSIS VIEW â€” 2 ×’×¨×¤×™×
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
function renderAnalysis() {
  if (!appData) return '';
  const gc = appData.good_chances || [];
  const bm = appData.beat_market  || [];

  // Chart 1: Good Chances â€” YES probability
  const gcLabels = gc.map(m => m.question);
  const gcValues = gc.map(m => m.yes_pct);
  const gcColors = gc.map(m => {
    const p = m.yes_pct;
    if (p >= 80) return 'rgba(16,185,129,0.75)';
    if (p >= 70) return 'rgba(52,211,153,0.65)';
    return 'rgba(251,191,36,0.65)';
  });

  // Chart 2: Beat the Market â€” ROI
  const bmLabels = bm.map(m => m.question);
  const bmValues = bm.map(m => m.roi_pct || 0);
  const bmColors = bm.map(m => {
    const r = m.roi_pct || 0;
    if (r >= 40) return 'rgba(124,58,237,0.8)';
    if (r >= 20) return 'rgba(139,92,246,0.65)';
    return 'rgba(167,139,250,0.55)';
  });

  const html = `
  <div class="section">
    <div class="section-header">
      <h2 class="section-title">ğŸ“Š × ×™×ª×•×— ×©×•×§</h2>
    </div>

    ${appData.recommendation ? renderRecommendation(appData.recommendation) : ''}

    <!-- Chart 1 -->
    <div class="chart-wrap">
      <div class="chart-title">âœ… ×¡×™×›×•×™×™× ×˜×•×‘×™×</div>
      <div class="chart-subtitle">×©×•×•×§×™× ×¢× ×”×¡×ª×‘×¨×•×ª YES ×‘×™×Ÿ 65â€“90% ×•× ×–×™×œ×•×ª ×’×‘×•×”×” â€” ××–×•×¨ ×”×‘×™×˜×—×•×Ÿ ×©×œ× ×•</div>
      <div class="chart-canvas-wrap">
        <canvas id="goodChancesChart"></canvas>
      </div>
    </div>

    <!-- Chart 2 -->
    <div class="chart-wrap">
      <div class="chart-title">ğŸš€ ×œ×”×›×•×ª ××ª ×”×©×•×§</div>
      <div class="chart-subtitle">×©×•×•×§×™× ×¢× ROI × ×˜×• ×”×’×‘×•×” ×‘×™×•×ª×¨ (××—×¨×™ ××¡ 25% + ×¢××œ×”) â€” ×”-Edge ×©×œ× ×•</div>
      <div class="chart-canvas-wrap">
        <canvas id="beatMarketChart"></canvas>
      </div>
    </div>
  </div>`;

  // Mount charts after DOM update
  setTimeout(() => {
    buildHorizontalBar('goodChancesChart', gcLabels, gcValues, gcColors, '%');
    buildHorizontalBar('beatMarketChart',  bmLabels, bmValues, bmColors, '%');
  }, 50);

  return html;
}

/* â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
   SIGNALS VIEW
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
function timeAgo(ts) {
  if (!ts) return '';
  const diff = Math.round((Date.now() - new Date(ts)) / 60000);
  if (diff < 1)  return '×¢×›×©×™×•';
  if (diff < 60) return `×œ×¤× ×™ ${diff} ×“×§×³`;
  const h = Math.round(diff / 60);
  if (h < 24)    return `×œ×¤× ×™ ${h} ×©×¢×³`;
  return `×œ×¤× ×™ ${Math.round(h/24)} ×™××™×`;
}

function renderSignals() {
  const signals = (appData && appData.signals) || [];
  if (!signals.length) {
    return `<div class="empty-watch"><span class="empty-icon">ğŸ“¡</span><p>××™×Ÿ signals ×¢×“×™×™×Ÿ â€” ×”×× ×•×¢ ×××ª×™×Ÿ ×œ× ×ª×•× ×™×...</p></div>`;
  }

  const strengthConfig = {
    'STRONG':     { emoji: 'ğŸ”´', color: 'var(--no)',    label: 'STRONG' },
    'WHALE_FADE': { emoji: 'ğŸ‹', color: '#a855f7',      label: 'WHALE FADE' },
    'MEDIUM':     { emoji: 'ğŸŸ¡', color: '#f59e0b',      label: 'MEDIUM' },
  };

  const cards = signals.map(s => {
    const cfg      = strengthConfig[s.strength] || { emoji: 'âš«', color: 'var(--text-2)', label: s.strength };
    const betSide  = s.bet_side || 'Yes';
    const sideClr  = betSide === 'Yes' ? 'var(--yes)' : 'var(--no)';
    const yesPrice = (s.yes_price * 100).toFixed(1);
    const noPrice  = (s.no_price  * 100).toFixed(1);
    const action   = s.action === 'EXECUTE' ? 'ğŸŸ¢ EXECUTE' : 'âšª DRY_RUN';
    const whaleRow = s.whale_names && s.whale_names.length
      ? `<div style="margin-top:6px;font-size:12px;color:var(--text-2)">ğŸ‹ ${s.whale_names.join(', ')}</div>`
      : '';
    const reasons  = (s.reasons || []).slice(0, 3).map(r =>
      `<span style="background:rgba(255,255,255,0.07);border-radius:4px;padding:2px 6px;font-size:11px;color:var(--text-2)">${r}</span>`
    ).join(' ');

    return `
    <div class="card" style="border-right: 3px solid ${cfg.color}; margin-bottom: var(--s-sm)">
      <div style="display:flex;align-items:center;gap:8px;margin-bottom:8px;flex-wrap:wrap">
        <span style="background:${cfg.color}22;color:${cfg.color};border:1px solid ${cfg.color}44;border-radius:6px;padding:3px 8px;font-size:12px;font-weight:700">${cfg.emoji} ${cfg.label}</span>
        <span style="background:rgba(255,255,255,0.08);border-radius:6px;padding:3px 8px;font-size:12px;color:var(--text-2)">${s.score}/100</span>
        <span style="background:${sideClr}22;color:${sideClr};border-radius:6px;padding:3px 8px;font-size:12px;font-weight:600">×”×™××•×¨: ${betSide}</span>
        <span style="margin-right:auto;font-size:11px;color:var(--text-3)">${timeAgo(s.timestamp)}</span>
      </div>
      <div style="font-size:15px;font-weight:700;color:var(--text-1);margin-bottom:8px;line-height:1.4">${s.question}</div>
      <div style="display:flex;gap:16px;margin-bottom:6px;font-size:13px;flex-wrap:wrap">
        <span>×›×Ÿ <strong style="color:var(--yes)">${yesPrice}%</strong></span>
        <span>×œ× <strong style="color:var(--no)">${noPrice}%</strong></span>
        <span>â± ${s.days_left}d</span>
        <span>Kelly ${s.kelly_pct}%</span>
        <span>ğŸ’° $${s.size_usd}</span>
        <span style="color:var(--text-3)">${action}</span>
      </div>
      ${whaleRow}
      <div style="margin-top:8px;display:flex;flex-wrap:wrap;gap:4px">${reasons}</div>
    </div>`;
  }).join('');

  return `
  <div class="section">
    <div class="section-header">
      <h2 class="section-title">ğŸ“¡ Signals â€” ×× ×•×¢ ×”×”×–×“×× ×•×™×•×ª</h2>
      <span class="section-count">${signals.length}</span>
    </div>
    <div style="font-size:13px;color:var(--text-3);margin-bottom:var(--s-md)">
      ××¦×‘: âšª DRY_RUN (× ×™×˜×•×¨ ×‘×œ×‘×“) Â· ${signals.filter(s=>s.strength==='STRONG').length} STRONG Â· ${signals.filter(s=>s.strength==='MEDIUM').length} MEDIUM Â· ${signals.filter(s=>s.strength==='WHALE_FADE').length} WHALE_FADE
    </div>
    ${cards}
  </div>`;
}

function renderView() {
  const rc = document.getElementById('real-content');
  if (!appData) return;

  if (activeTab === 'signals') {
    rc.innerHTML = renderSignals();
    return;
  }

  if (activeTab === 'analysis') {
    rc.innerHTML = renderAnalysis();
    return;
  }

  if (activeTab === 'watch') {
    const ids = getWatchlist();
    if (!ids.length) {
      rc.innerHTML = `<div class="empty-watch"><span class="empty-icon">â­</span><p>××™×Ÿ ×©×•×•×§×™× ×‘××¢×§×‘ ×¢×“×™×™×Ÿ.<br>×œ×—×¥ ×¢×œ â­ ×‘×›×œ ×©×•×§ ×›×“×™ ×œ×”×•×¡×™×£.</p></div>`;
      return;
    }
    const all = [...(appData.hot||[]), ...(appData.movers||[]), ...(appData.new_interesting||[]), ...(appData.worth_watching||appData.watching||[])];
    const seen = new Set();
    const watched = ids.map(id => all.find(m => String(m.id) === id)).filter(Boolean).filter(m => { if (seen.has(m.id)) return false; seen.add(m.id); return true; });
    rc.innerHTML = renderSection('â­ ×©×•×•×§×™× ×‘××¢×§×‘', watched);
    return;
  }

  let html = '';
  // Show recommendation only on 'all' tab
  if (activeTab === 'all' && appData.recommendation) {
    html += `<div style="padding-top:var(--s-sm)">${renderRecommendation(appData.recommendation)}</div>`;
  }
  html += renderSection('ğŸ”¥ ×—× ×¢×›×©×™×•',        appData.hot              || [], false);
  html += renderSection('ğŸ“ˆ ×ª× ×•×¢×•×ª ×’×“×•×œ×•×ª',    appData.movers           || [], true);
  html += renderSection('âœ¨ ×—×“×© ×•××¢× ×™×™×Ÿ',      appData.new_interesting  || [], false);
  html += renderSection('ğŸ¯ ×©×•×•×” ×œ×¢×§×•×‘',       appData.worth_watching   || appData.watching || [], false);
  rc.innerHTML = html || `<div class="empty-watch"><span class="empty-icon">ğŸ”</span><p>××™×Ÿ ×©×•×•×§×™× ×‘×§×˜×’×•×¨×™×” ×–×• ×›×¨×’×¢.</p></div>`;
}

/* â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
   STATS BAR
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
function renderStats(d) {
  const totalVol = [...(d.hot||[]), ...(d.movers||[])].reduce((s, m) => s + (m.volume24hr||0), 0);
  const total    = (d.total_markets || (d.all_markets && d.all_markets.length) || 0);
  const updated  = fmtAgo(d.updated_at);
  document.getElementById('statsBar').innerHTML = `
    <div class="stat-pill"><span class="stat-icon">ğŸ“Š</span><span class="stat-val">${total}</span><span class="stat-lbl"> ×©×•×•×§×™×</span></div>
    <div class="stat-pill"><span class="stat-icon">ğŸ’°</span><span class="stat-val">${fmt$(totalVol)}</span><span class="stat-lbl"> × ×¤×— 24h</span></div>
    <div class="stat-pill"><span class="stat-icon">ğŸ”¥</span><span class="stat-val">${(d.hot||[]).length}</span><span class="stat-lbl"> ×—× ×¢×›×©×™×•</span></div>
    <div class="stat-pill"><span class="stat-icon">â°</span><span class="stat-val">${updated}</span><span class="stat-lbl"></span></div>
  `;
}

/* â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
   PRICE FLASH (micro-interaction)
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
function flashUpdated(newData, oldData) {
  if (!oldData) return;
  const allNew = [...(newData.hot||[]), ...(newData.movers||[])];
  const allOld = [...(oldData.hot||[]), ...(oldData.movers||[])];
  const oldMap  = Object.fromEntries(allOld.map(m => [m.id, m.yes_pct]));
  allNew.forEach(m => {
    const oldPct = oldMap[m.id];
    const el     = document.getElementById(`yes-${m.id}`);
    if (el && oldPct !== undefined && oldPct !== m.yes_pct) {
      el.classList.remove('flash-up','flash-down');
      void el.offsetWidth; // force reflow
      el.classList.add(m.yes_pct > oldPct ? 'flash-up' : 'flash-down');
    }
  });
}

/* â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
   DATA LOADING
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
async function loadData(isRefresh = false) {
  if (isRefresh) {
    const btn = document.getElementById('liveLabel');
    if (btn) btn.textContent = '...';
  }
  try {
    const r = await fetch(`${DATA_URL}?v=${Date.now()}`);
    if (!r.ok) throw new Error(`HTTP ${r.status}`);
    const d = await r.json();
    prevData = appData;
    appData  = d;

    // First load
    document.getElementById('skeleton-view').style.display = 'none';
    document.getElementById('real-content').style.display  = 'block';

    renderStats(d);
    renderView();
    if (isRefresh) flashUpdated(d, prevData);
    updateWatchBadge();
    // Signals badge
    const sigBadge = document.getElementById('signalsBadge');
    if (sigBadge && d.signals_count > 0) {
      sigBadge.textContent = d.signals_count;
      sigBadge.style.display = 'inline';
    }

    const lbl = document.getElementById('liveLabel');
    if (lbl) lbl.textContent = 'LIVE';
  } catch(e) {
    console.error('PolyDash load error:', e);
    const lbl = document.getElementById('liveLabel');
    if (lbl) lbl.textContent = 'âš ï¸';
  }
}

/* â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
   QUICK VIEW MODAL
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
function openModal(m) {
  modalMarket = m;
  const nr    = calcNet(m.yes_pct);
  const overlay = document.getElementById('modalOverlay');
  document.getElementById('modalTitle').textContent = m.question;

  let imgHtml = '';
  if (m.image) imgHtml = `<img class="modal-img" src="${esc(m.image)}" alt="" loading="lazy" onerror="this.style.display='none'" />`;

  let netBoxHtml = '';
  if (nr) {
    netBoxHtml = `
    <div class="modal-net-box">
      <div class="modal-net-title">ğŸ’° × ×˜×• ××—×¨×™ ××¡ ×•×¢××œ×” (×¢×œ $100 ×”×™××•×¨)</div>
      <div class="modal-net-val">+$${nr.net} <small style="font-size:16px;opacity:0.7">(ROI ${nr.roi}%)</small></div>
      <div class="modal-net-sub">×‘×¨×•×˜×•: +$${nr.gross} â€¢ ××¡ 25%: -$${(parseFloat(nr.gross)*0.25).toFixed(1)} â€¢ ×¢××œ×”: -$0.1</div>
    </div>`;
  }

  document.getElementById('modalBody').innerHTML = `
    ${imgHtml}
    <div class="modal-big-prob">
      <div class="big-prob-item yes-item">
        <div class="big-prob-lbl yes">YES</div>
        <div class="big-prob-val yes">${m.yes_pct||0}%</div>
      </div>
      <div class="big-prob-item no-item">
        <div class="big-prob-lbl no">NO</div>
        <div class="big-prob-val no">${m.no_pct||0}%</div>
      </div>
    </div>
    ${netBoxHtml}
    <div class="modal-meta-grid">
      <div class="meta-item"><div class="meta-lbl">×§×˜×’×•×¨×™×”</div><div class="meta-val">${catEmoji(m.category)}</div></div>
      <div class="meta-item"><div class="meta-lbl">× ×¤×— 24h</div><div class="meta-val">${fmt$(m.volume24hr)}</div></div>
      <div class="meta-item"><div class="meta-lbl">× ×¤×— ×›×•×œ×œ</div><div class="meta-val">${fmt$(m.volume)}</div></div>
      <div class="meta-item"><div class="meta-lbl">×ª××¨×™×š ×¡×’×™×¨×”</div><div class="meta-val">${fmtDate(m.end_date)}</div></div>
    </div>
    ${m.interesting ? `<div class="modal-desc">ğŸ’¡ ${esc(m.interesting)}</div>` : ''}
    <a class="modal-cta" href="${esc(m.link||'https://polymarket.com')}" target="_blank" rel="noopener">×¤×ª×— ×‘-Polymarket â†—</a>
  `;

  overlay.classList.add('open');
  document.body.style.overflow = 'hidden';
}

function closeModal() {
  document.getElementById('modalOverlay').classList.remove('open');
  document.body.style.overflow = '';
  modalMarket = null;
}

/* â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
   EVENT DELEGATION
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
document.getElementById('mainContent').addEventListener('click', e => {
  // Star button
  const starBtn = e.target.closest('[data-star]');
  if (starBtn) { e.preventDefault(); e.stopPropagation(); toggleWatch(starBtn.dataset.star, starBtn); return; }

  // View button
  const viewBtn = e.target.closest('[data-view]');
  if (viewBtn) {
    e.preventDefault(); e.stopPropagation();
    const id  = viewBtn.dataset.view;
    const all = [...(appData?.hot||[]), ...(appData?.movers||[]), ...(appData?.new_interesting||[]), ...(appData?.worth_watching||appData?.watching||[])];
    const m   = all.find(x => String(x.id) === String(id));
    if (m) openModal(m);
    return;
  }

  // Card click â†’ open modal
  const card = e.target.closest('.card');
  if (card && appData) {
    const id  = card.dataset.id;
    const all = [...(appData.hot||[]), ...(appData.movers||[]), ...(appData.new_interesting||[]), ...(appData.worth_watching||appData.watching||[])];
    const m   = all.find(x => String(x.id) === String(id));
    if (m) openModal(m);
  }
});

// Keyboard accessibility for cards
document.getElementById('mainContent').addEventListener('keydown', e => {
  if (e.key === 'Enter' || e.key === ' ') {
    const card = e.target.closest('.card');
    if (card) { e.preventDefault(); card.click(); }
  }
});

// Modal close
document.getElementById('modalClose').addEventListener('click', closeModal);
document.getElementById('modalOverlay').addEventListener('click', e => {
  if (e.target === document.getElementById('modalOverlay')) closeModal();
});
document.addEventListener('keydown', e => { if (e.key === 'Escape') closeModal(); });

// Tabs
document.getElementById('tabs').addEventListener('click', e => {
  const tab = e.target.closest('.tab');
  if (!tab) return;
  document.querySelectorAll('.tab').forEach(t => { t.classList.remove('active'); t.setAttribute('aria-selected','false'); });
  tab.classList.add('active');
  tab.setAttribute('aria-selected','true');
  activeTab = tab.dataset.cat;
  renderView();
});

// Refresh button
document.getElementById('refreshBtn').addEventListener('click', () => loadData(true));

/* â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
   INIT & AUTO-REFRESH
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
loadData();
setInterval(() => loadData(true), REFRESH_MS);
updateWatchBadge();
</script>
</body>
</html>
