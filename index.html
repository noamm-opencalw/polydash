<!DOCTYPE html>
<html lang="he" dir="rtl">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0" />
  <title>PolyDash â€” ×©×•×§ ×”× ×™×‘×•×™×™×</title>
  <meta name="description" content="PolyDash â€” ×œ×•×— ××—×•×•× ×™× ×—×™ ×œ×©×•×§ ×”× ×™×‘×•×™×™× Polymarket" />

  <style>
    /* â”€â”€â”€ RESET & BASE â”€â”€â”€ */
    *, *::before, *::after { box-sizing: border-box; margin: 0; padding: 0; }

    :root {
      --purple:     #6C37F4;
      --purple-lt:  #EDE8FF;
      --purple-dk:  #4B20D4;
      --green:      #00C853;
      --green-lt:   #E8F9F0;
      --red:        #F44336;
      --red-lt:     #FEECEB;
      --bg:         #F8FAFC;
      --card:       #FFFFFF;
      --border:     #E8ECF2;
      --text:       #111827;
      --text-sm:    #6B7280;
      --shadow:     0 1px 4px rgba(0,0,0,.06), 0 4px 16px rgba(0,0,0,.05);
      --shadow-hov: 0 4px 12px rgba(108,55,244,.12), 0 8px 32px rgba(0,0,0,.08);
      --radius:     16px;
      --radius-sm:  10px;
    }

    html { scroll-behavior: smooth; }

    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
      background: var(--bg);
      color: var(--text);
      min-height: 100vh;
      direction: rtl;
    }

    /* â”€â”€â”€ HEADER â”€â”€â”€ */
    header {
      position: sticky; top: 0; z-index: 100;
      background: rgba(255,255,255,.92);
      backdrop-filter: blur(16px);
      -webkit-backdrop-filter: blur(16px);
      border-bottom: 1.5px solid var(--border);
    }

    .header-inner {
      max-width: 520px;
      margin: 0 auto;
      padding: 0 16px;
    }

    .header-top {
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 14px 0 10px;
    }

    .logo {
      display: flex;
      align-items: center;
      gap: 8px;
    }

    .logo-icon {
      width: 32px; height: 32px;
      background: var(--purple);
      border-radius: 8px;
      display: flex; align-items: center; justify-content: center;
      font-size: 16px;
    }

    .logo-text {
      font-size: 20px;
      font-weight: 800;
      color: var(--purple);
      letter-spacing: -0.5px;
    }

    .logo-sub {
      font-size: 11px;
      color: var(--text-sm);
      font-weight: 400;
    }

    .refresh-btn {
      display: flex; align-items: center; gap: 5px;
      background: var(--purple-lt);
      color: var(--purple);
      border: none; border-radius: 20px;
      padding: 6px 12px;
      font-size: 12px; font-weight: 600;
      cursor: pointer;
      transition: all .2s;
    }
    .refresh-btn:hover { background: var(--purple); color: #fff; }
    .refresh-btn.spinning .spin-icon { animation: spin 1s linear infinite; }
    @keyframes spin { to { transform: rotate(360deg); } }

    .spin-icon { display: inline-block; font-style: normal; }

    /* â”€â”€â”€ TAB NAV â”€â”€â”€ */
    .tabs-scroll {
      overflow-x: auto;
      padding-bottom: 10px;
      scrollbar-width: none;
      -ms-overflow-style: none;
    }
    .tabs-scroll::-webkit-scrollbar { display: none; }

    .tabs {
      display: flex;
      gap: 6px;
      white-space: nowrap;
    }

    .tab-btn {
      background: none;
      border: 1.5px solid var(--border);
      border-radius: 20px;
      padding: 5px 14px;
      font-size: 13px;
      font-weight: 600;
      color: var(--text-sm);
      cursor: pointer;
      transition: all .2s;
      font-family: inherit;
    }
    .tab-btn:hover { border-color: var(--purple); color: var(--purple); }
    .tab-btn.active {
      background: var(--purple);
      border-color: var(--purple);
      color: #fff;
    }

    /* â”€â”€â”€ MAIN CONTENT â”€â”€â”€ */
    main {
      max-width: 520px;
      margin: 0 auto;
      padding: 16px 16px 80px;
    }

    /* â”€â”€â”€ SECTION HEADERS â”€â”€â”€ */
    .section { margin-bottom: 28px; }

    .section-header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      margin-bottom: 14px;
    }

    .section-title {
      font-size: 18px;
      font-weight: 800;
      color: var(--text);
      display: flex; align-items: center; gap: 6px;
    }

    .section-count {
      font-size: 11px;
      background: var(--purple-lt);
      color: var(--purple);
      border-radius: 10px;
      padding: 2px 8px;
      font-weight: 700;
    }

    /* â”€â”€â”€ CARDS â”€â”€â”€ */
    .card {
      background: var(--card);
      border-radius: var(--radius);
      box-shadow: var(--shadow);
      padding: 16px;
      margin-bottom: 10px;
      border: 1.5px solid var(--border);
      transition: box-shadow .2s, transform .2s;
      cursor: pointer;
      text-decoration: none;
      color: inherit;
      display: block;
    }
    .card:hover {
      box-shadow: var(--shadow-hov);
      transform: translateY(-1px);
      border-color: rgba(108,55,244,.2);
    }
    .card:last-child { margin-bottom: 0; }

    /* â”€â”€â”€ HOT MARKET CARD â”€â”€â”€ */
    .hot-card {
      display: grid;
      grid-template-columns: 1fr auto;
      gap: 12px;
      align-items: start;
    }

    .card-rank {
      font-size: 11px;
      font-weight: 700;
      color: var(--text-sm);
      margin-bottom: 4px;
      text-transform: uppercase;
      letter-spacing: .5px;
    }

    .card-title {
      font-size: 14px;
      font-weight: 600;
      color: var(--text);
      line-height: 1.4;
      margin-bottom: 8px;
    }

    .card-meta {
      display: flex;
      flex-wrap: wrap;
      gap: 6px;
      align-items: center;
    }

    .meta-chip {
      font-size: 11px;
      color: var(--text-sm);
      background: var(--bg);
      border-radius: 6px;
      padding: 2px 7px;
      font-weight: 500;
    }

    .vol-chip {
      font-size: 11px;
      font-weight: 700;
      color: var(--purple);
      background: var(--purple-lt);
      border-radius: 6px;
      padding: 2px 8px;
    }

    /* â”€â”€â”€ BIG PROBABILITY DISPLAY â”€â”€â”€ */
    .prob-block {
      display: flex;
      flex-direction: column;
      align-items: center;
      min-width: 72px;
    }

    .prob-big {
      font-size: 36px;
      font-weight: 900;
      line-height: 1;
      letter-spacing: -1px;
    }
    .prob-big.yes { color: var(--green); }
    .prob-big.no  { color: var(--red); }
    .prob-big.mid { color: var(--purple); }

    .prob-label {
      font-size: 10px;
      font-weight: 700;
      letter-spacing: 1px;
      text-transform: uppercase;
      margin-top: 2px;
    }
    .prob-label.yes { color: var(--green); }
    .prob-label.no  { color: var(--red); }
    .prob-label.mid { color: var(--purple); }

    /* â”€â”€â”€ DUAL PROB BAR â”€â”€â”€ */
    .prob-bar {
      display: flex;
      height: 5px;
      border-radius: 3px;
      overflow: hidden;
      margin-top: 8px;
      gap: 2px;
    }
    .prob-bar-yes { background: var(--green); border-radius: 3px; }
    .prob-bar-no  { background: var(--red);   border-radius: 3px; }

    /* â”€â”€â”€ MOVER CARD â”€â”€â”€ */
    .mover-card {
      display: grid;
      grid-template-columns: 1fr auto;
      gap: 12px;
      align-items: center;
    }

    .mover-change {
      display: flex;
      flex-direction: column;
      align-items: center;
      min-width: 64px;
    }

    .mover-pct {
      font-size: 22px;
      font-weight: 900;
      letter-spacing: -0.5px;
      line-height: 1;
    }
    .mover-pct.up   { color: var(--green); }
    .mover-pct.down { color: var(--red);   }

    .mover-arrow {
      font-size: 14px;
      margin-top: 2px;
    }
    .mover-arrow.up   { color: var(--green); }
    .mover-arrow.down { color: var(--red);   }

    /* â”€â”€â”€ NEW MARKET CARD â”€â”€â”€ */
    .new-card-body {
      display: flex;
      flex-direction: column;
      gap: 8px;
    }

    .new-card-top {
      display: flex;
      justify-content: space-between;
      align-items: flex-start;
      gap: 12px;
    }

    .new-badge {
      font-size: 10px;
      font-weight: 800;
      letter-spacing: .8px;
      text-transform: uppercase;
      background: linear-gradient(90deg, #6C37F4, #9B6EFF);
      color: #fff;
      border-radius: 6px;
      padding: 3px 8px;
      white-space: nowrap;
      flex-shrink: 0;
    }

    .interesting-text {
      font-size: 12px;
      color: var(--text-sm);
      line-height: 1.4;
      padding: 7px 10px;
      background: var(--bg);
      border-radius: var(--radius-sm);
      border-right: 3px solid var(--purple);
    }

    /* â”€â”€â”€ WORTH WATCHING â”€â”€â”€ */
    .watch-card {
      display: flex;
      flex-direction: column;
      gap: 10px;
    }

    .watch-top {
      display: flex;
      justify-content: space-between;
      align-items: flex-start;
      gap: 12px;
    }

    .cat-tag {
      font-size: 11px;
      font-weight: 700;
      border-radius: 6px;
      padding: 3px 9px;
      white-space: nowrap;
      flex-shrink: 0;
    }
    .cat-politics  { background: #EEF2FF; color: #4338CA; }
    .cat-economy   { background: #FFF7ED; color: #C2410C; }
    .cat-sports    { background: #ECFDF5; color: #065F46; }
    .cat-crypto    { background: #FEF9C3; color: #854D0E; }
    .cat-tech      { background: #F0F9FF; color: #0369A1; }
    .cat-geo       { background: #FDF4FF; color: #7E22CE; }
    .cat-other     { background: var(--bg); color: var(--text-sm); }

    .watch-probs {
      display: flex;
      gap: 8px;
      align-items: center;
    }

    .watch-yes {
      font-size: 26px;
      font-weight: 900;
      color: var(--green);
      letter-spacing: -0.5px;
      line-height: 1;
    }
    .watch-divider {
      font-size: 14px;
      color: var(--border);
      font-weight: 300;
    }
    .watch-no {
      font-size: 20px;
      font-weight: 700;
      color: var(--red);
      letter-spacing: -0.5px;
      line-height: 1;
    }

    .watch-label-row {
      display: flex;
      gap: 8px;
      align-items: center;
    }
    .wl { font-size: 10px; font-weight: 700; letter-spacing: .8px; text-transform: uppercase; }
    .wl.yes { color: var(--green); }
    .wl.no  { color: var(--red); }

    /* â”€â”€â”€ LOADING / EMPTY â”€â”€â”€ */
    .loading-state {
      text-align: center;
      padding: 48px 16px;
    }
    .loading-spinner {
      width: 40px; height: 40px;
      border: 3px solid var(--border);
      border-top-color: var(--purple);
      border-radius: 50%;
      animation: spin 0.8s linear infinite;
      margin: 0 auto 16px;
    }
    .loading-text { color: var(--text-sm); font-size: 14px; }

    .error-state {
      text-align: center;
      padding: 32px 16px;
      background: var(--red-lt);
      border-radius: var(--radius);
      border: 1.5px solid var(--red);
    }

    /* â”€â”€â”€ UPDATED TIMESTAMP â”€â”€â”€ */
    .updated-bar {
      text-align: center;
      font-size: 11px;
      color: var(--text-sm);
      padding: 8px 0 0;
      margin-bottom: -4px;
    }
    .updated-bar span { color: var(--purple); font-weight: 600; }

    /* â”€â”€â”€ FOOTER â”€â”€â”€ */
    footer {
      position: fixed; bottom: 0; left: 0; right: 0;
      background: rgba(255,255,255,.95);
      backdrop-filter: blur(12px);
      -webkit-backdrop-filter: blur(12px);
      border-top: 1.5px solid var(--border);
      text-align: center;
      padding: 10px 16px;
      font-size: 11px;
      color: var(--text-sm);
    }
    footer a { color: var(--purple); text-decoration: none; font-weight: 600; }

    /* â”€â”€â”€ ALL MARKETS SECTION â”€â”€â”€ */
    #section-all { display: none; }

    /* â”€â”€â”€ CATEGORY HIDDEN â”€â”€â”€ */
    .cat-hidden { display: none !important; }

    /* â”€â”€â”€ RESPONSIVE â”€â”€â”€ */
    @media (min-width: 540px) {
      .header-inner, main { max-width: 520px; }
    }
  </style>
</head>

<body>

<!-- HEADER -->
<header>
  <div class="header-inner">
    <div class="header-top">
      <div class="logo">
        <div class="logo-icon">ğŸ“Š</div>
        <div>
          <div class="logo-text">PolyDash</div>
          <div class="logo-sub">×©×•×§ ×”× ×™×‘×•×™×™× ×‘×–××Ÿ ×××ª</div>
        </div>
      </div>
      <button class="refresh-btn" id="refreshBtn" onclick="refreshData()">
        <span class="spin-icon" id="spinIcon">â†»</span>
        <span id="refreshLabel">×¨×¢× ×Ÿ</span>
      </button>
    </div>
    <div class="tabs-scroll">
      <div class="tabs" id="tabsBar">
        <button class="tab-btn active" data-cat="all" onclick="filterCat(this, 'all')">×”×›×œ</button>
        <button class="tab-btn" data-cat="politics" onclick="filterCat(this, 'politics')">ğŸ—³ï¸ ×¤×•×œ×™×˜×™×§×”</button>
        <button class="tab-btn" data-cat="economy" onclick="filterCat(this, 'economy')">ğŸ’° ×›×œ×›×œ×”</button>
        <button class="tab-btn" data-cat="sports" onclick="filterCat(this, 'sports')">ğŸ† ×¡×¤×•×¨×˜</button>
        <button class="tab-btn" data-cat="crypto" onclick="filterCat(this, 'crypto')">â‚¿ ×§×¨×™×¤×˜×•</button>
        <button class="tab-btn" data-cat="tech" onclick="filterCat(this, 'tech')">ğŸ”¬ ×˜×›× ×•×œ×•×’×™×”</button>
        <button class="tab-btn" data-cat="geo" onclick="filterCat(this, 'geo')">ğŸŒ ×’××•×¤×•×œ×™×˜×™×§×”</button>
      </div>
    </div>
  </div>
</header>

<!-- MAIN -->
<main id="mainContent">
  <div class="loading-state" id="loadingState">
    <div class="loading-spinner"></div>
    <div class="loading-text">×˜×•×¢×Ÿ × ×ª×•× ×™ ×©×•×§...</div>
  </div>
</main>

<!-- FOOTER -->
<footer>
  × ×ª×•× ×™× × <a href="https://polymarket.com" target="_blank" rel="noopener">Polymarket</a> â€¢
  ××ª×¢×“×›×Ÿ ××•×˜×•××˜×™×ª ×›×œ ×©×¢×”
</footer>

<script>
let allData = null;
let currentCat = 'all';
let refreshTimer = null;

// â”€â”€â”€ HELPERS â”€â”€â”€
function fmt(n) {
  if (n >= 1_000_000) return '$' + (n / 1_000_000).toFixed(1) + 'M';
  if (n >= 1_000)     return '$' + (n / 1_000).toFixed(0) + 'K';
  return '$' + n.toFixed(0);
}

function fmtDate(iso) {
  if (!iso) return '';
  try {
    const d = new Date(iso);
    return d.toLocaleDateString('he-IL', { day: 'numeric', month: 'short', year: '2-digit' });
  } catch { return ''; }
}

function probClass(pct) {
  if (pct >= 60) return 'yes';
  if (pct <= 40) return 'no';
  return 'mid';
}

function catLabel(cat) {
  const labels = {
    politics: 'ğŸ—³ï¸ ×¤×•×œ×™×˜×™×§×”',
    economy:  'ğŸ’° ×›×œ×›×œ×”',
    sports:   'ğŸ† ×¡×¤×•×¨×˜',
    crypto:   'â‚¿ ×§×¨×™×¤×˜×•',
    tech:     'ğŸ”¬ ×˜×›× ×•×œ×•×’×™×”',
    geo:      'ğŸŒ ×’××•×¤×•×œ×™×˜×™×§×”',
    other:    'ğŸ“Š ×©×•× ×•×ª',
  };
  return labels[cat] || 'ğŸ“Š ×©×•× ×•×ª';
}

function daysAgo(iso) {
  try {
    const d = new Date(iso);
    const diff = (Date.now() - d.getTime()) / 86400000;
    if (diff < 1) return '×”×™×•×';
    if (diff < 2) return '××ª××•×œ';
    return `×œ×¤× ×™ ${Math.floor(diff)} ×™××™×`;
  } catch { return ''; }
}

// â”€â”€â”€ BUILD CARDS â”€â”€â”€
function hotCard(m, rank) {
  const pc = probClass(m.yes_pct);
  const yWidth = m.yes_pct;
  return `
  <a class="card" href="${m.link}" target="_blank" rel="noopener" data-cat="${m.category}">
    <div class="hot-card">
      <div>
        <div class="card-rank">#${rank} â€¢ ${catLabel(m.category)}</div>
        <div class="card-title">${m.question}</div>
        <div class="card-meta">
          <span class="vol-chip">ğŸ”¥ ${fmt(m.volume24hr)} ×”×™×•×</span>
          ${m.end_date ? `<span class="meta-chip">â° ${fmtDate(m.end_date)}</span>` : ''}
          ${m.volume ? `<span class="meta-chip">ğŸ“Š ${fmt(m.volume)}</span>` : ''}
        </div>
        <div class="prob-bar" style="margin-top:10px">
          <div class="prob-bar-yes" style="flex:${yWidth}"></div>
          <div class="prob-bar-no"  style="flex:${100 - yWidth}"></div>
        </div>
      </div>
      <div class="prob-block">
        <div class="prob-big ${pc}">${m.yes_pct}%</div>
        <div class="prob-label ${pc}">YES</div>
      </div>
    </div>
  </a>`;
}

function moverCard(m) {
  const up = m.oneWeekPriceChange >= 0;
  const pct = Math.abs(m.oneWeekPriceChange * 100).toFixed(1);
  const dir = up ? 'up' : 'down';
  const arrow = up ? 'â†‘' : 'â†“';
  return `
  <a class="card" href="${m.link}" target="_blank" rel="noopener" data-cat="${m.category}">
    <div class="mover-card">
      <div>
        <div class="card-rank">${catLabel(m.category)}</div>
        <div class="card-title">${m.question}</div>
        <div class="card-meta">
          <span class="meta-chip">×›×¢×ª: ${m.yes_pct}% YES</span>
          ${m.volume24hr ? `<span class="vol-chip">${fmt(m.volume24hr)}/24h</span>` : ''}
        </div>
      </div>
      <div class="mover-change">
        <div class="mover-pct ${dir}">${up ? '+' : '-'}${pct}%</div>
        <div class="mover-arrow ${dir}">${arrow} ×©×‘×•×¢</div>
      </div>
    </div>
  </a>`;
}

function newCard(m) {
  return `
  <a class="card" href="${m.link}" target="_blank" rel="noopener" data-cat="${m.category}">
    <div class="new-card-body">
      <div class="new-card-top">
        <div class="card-title">${m.question}</div>
        <span class="new-badge">×—×“×©!</span>
      </div>
      <div class="interesting-text">${m.interesting}</div>
      <div class="card-meta">
        <span class="meta-chip">${daysAgo(m.start_date)}</span>
        <span class="meta-chip">YES: ${m.yes_pct}%</span>
        ${m.liquidity ? `<span class="vol-chip">ğŸ’§ ${fmt(m.liquidity)}</span>` : ''}
      </div>
    </div>
  </a>`;
}

function watchCard(m) {
  const catCls = 'cat-' + m.category;
  return `
  <a class="card" href="${m.link}" target="_blank" rel="noopener" data-cat="${m.category}">
    <div class="watch-card">
      <div class="watch-top">
        <div class="card-title">${m.question}</div>
        <span class="cat-tag ${catCls}">${catLabel(m.category)}</span>
      </div>
      <div>
        <div class="watch-probs">
          <div class="watch-yes">${m.yes_pct}%</div>
          <div class="watch-divider">|</div>
          <div class="watch-no">${m.no_pct}%</div>
        </div>
        <div class="watch-label-row">
          <span class="wl yes">YES</span>
          <span class="wl no">NO</span>
        </div>
      </div>
      <div class="interesting-text">${m.interesting}</div>
    </div>
  </a>`;
}

function allMarketCard(m) {
  const pc = probClass(m.yes_pct);
  return `
  <a class="card" href="${m.link}" target="_blank" rel="noopener" data-cat="${m.category}">
    <div class="hot-card">
      <div>
        <div class="card-rank">${catLabel(m.category)}</div>
        <div class="card-title">${m.question}</div>
        <div class="card-meta">
          ${m.volume24hr ? `<span class="vol-chip">${fmt(m.volume24hr)}/24h</span>` : ''}
          ${m.end_date ? `<span class="meta-chip">â° ${fmtDate(m.end_date)}</span>` : ''}
        </div>
      </div>
      <div class="prob-block">
        <div class="prob-big ${pc}">${m.yes_pct}%</div>
        <div class="prob-label ${pc}">YES</div>
      </div>
    </div>
  </a>`;
}

// â”€â”€â”€ RENDER â”€â”€â”€
function render(data) {
  const main = document.getElementById('mainContent');

  const updatedTime = data.updated_at
    ? new Date(data.updated_at).toLocaleTimeString('he-IL', { hour: '2-digit', minute: '2-digit' })
    : '';

  let html = `<div class="updated-bar">×¢×•×“×›×Ÿ ×œ××—×¨×•× ×”: <span>${updatedTime}</span></div>`;

  const isAll = currentCat === 'all';

  // â”€â”€ Section: All Markets (when category selected) â”€â”€
  if (!isAll) {
    const filtered = (data.all_markets || []).filter(m => m.category === currentCat);
    html += `
    <div class="section" id="section-cat">
      <div class="section-header">
        <span class="section-title">${catLabel(currentCat)}</span>
        <span class="section-count">${filtered.length} ×©×•×•×§×™×</span>
      </div>
      ${filtered.length
        ? filtered.map(m => allMarketCard(m)).join('')
        : `<div class="loading-state"><div class="loading-text">××™×Ÿ ×©×•×•×§×™× ×‘×§×˜×’×•×¨×™×” ×–×•</div></div>`
      }
    </div>`;
    main.innerHTML = html;
    return;
  }

  // â”€â”€ Section 1: Hot Markets â”€â”€
  if (data.hot && data.hot.length) {
    html += `
    <div class="section">
      <div class="section-header">
        <span class="section-title">ğŸ”¥ ×—× ×¢×›×©×™×•</span>
        <span class="section-count">Top ${data.hot.length}</span>
      </div>
      ${data.hot.map((m, i) => hotCard(m, i + 1)).join('')}
    </div>`;
  }

  // â”€â”€ Section 2: Big Movers â”€â”€
  if (data.movers && data.movers.length) {
    html += `
    <div class="section">
      <div class="section-header">
        <span class="section-title">ğŸ“ˆ ×ª× ×•×¢×•×ª ×’×“×•×œ×•×ª</span>
        <span class="section-count">×©×™× ×•×™ ×©×‘×•×¢×™</span>
      </div>
      ${data.movers.map(m => moverCard(m)).join('')}
    </div>`;
  }

  // â”€â”€ Section 3: New & Interesting â”€â”€
  if (data.new_interesting && data.new_interesting.length) {
    html += `
    <div class="section">
      <div class="section-header">
        <span class="section-title">âœ¨ ×—×“×© ×•××¢× ×™×™×Ÿ</span>
        <span class="section-count">14 ×™××™× ××—×¨×•× ×™×</span>
      </div>
      ${data.new_interesting.map(m => newCard(m)).join('')}
    </div>`;
  }

  // â”€â”€ Section 4: Worth Watching â”€â”€
  if (data.worth_watching && data.worth_watching.length) {
    html += `
    <div class="section">
      <div class="section-header">
        <span class="section-title">ğŸ¯ ×©×•×•×” ×œ×¢×§×•×‘</span>
        <span class="section-count">×”××œ×¦×•×ª ×¢×•×¨×š</span>
      </div>
      ${data.worth_watching.map(m => watchCard(m)).join('')}
    </div>`;
  }

  main.innerHTML = html;
}

// â”€â”€â”€ FILTER â”€â”€â”€
function filterCat(btn, cat) {
  currentCat = cat;
  document.querySelectorAll('.tab-btn').forEach(b => b.classList.remove('active'));
  btn.classList.add('active');
  if (allData) render(allData);
}

// â”€â”€â”€ LOAD DATA â”€â”€â”€
async function loadData() {
  try {
    const r = await fetch('data.json?t=' + Date.now());
    if (!r.ok) throw new Error('HTTP ' + r.status);
    allData = await r.json();
    render(allData);
  } catch (e) {
    document.getElementById('mainContent').innerHTML = `
      <div class="error-state">
        <div style="font-size:32px;margin-bottom:8px">âš ï¸</div>
        <div style="font-weight:700;margin-bottom:4px">×œ× × ×™×ª×Ÿ ×œ×˜×¢×•×Ÿ × ×ª×•× ×™×</div>
        <div style="font-size:12px;color:var(--text-sm)">${e.message}</div>
      </div>`;
  }
}

// â”€â”€â”€ REFRESH â”€â”€â”€
async function refreshData() {
  const btn = document.getElementById('refreshBtn');
  const spin = document.getElementById('spinIcon');
  const label = document.getElementById('refreshLabel');
  btn.classList.add('spinning');
  label.textContent = '×˜×•×¢×Ÿ...';
  await loadData();
  btn.classList.remove('spinning');
  label.textContent = '×¨×¢× ×Ÿ';
}

// â”€â”€â”€ AUTO-REFRESH every 5 minutes â”€â”€â”€
function startAutoRefresh() {
  if (refreshTimer) clearInterval(refreshTimer);
  refreshTimer = setInterval(loadData, 5 * 60 * 1000);
}

// â”€â”€â”€ INIT â”€â”€â”€
loadData();
startAutoRefresh();
</script>
</body>
</html>
